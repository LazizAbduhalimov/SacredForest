using System;
using Game;
using Unity.Burst.Intrinsics;
using UnityEngine;

namespace Client.Game
{
    [Serializable]
    public class CrushingVulnerability : IAbility
    {
        public void OnGetHit(Unit attacker, Unit target, AttackContext context)
        {
            Debug.Log(attacker.Weapon.DamageType);
            if (attacker.Weapon.DamageType != DamageType.Crushing) return;
            context.DamageMultiplier = 2;

            if (context.IsMissed) return;
            DamageNumbers.Instance.SpawnNumber($"Weak! x2 dmg", target.transform.position, DamageNumbers.DamageType.Damage);
            Debug.Log($"Crushing Vulnerability triggered! Damage doubled.");
        }
    }

    [SerializeField]
    public class ChopInvincibility : IAbility
    {
        public void OnGetHit(Unit attacker, Unit target, AttackContext context)
        {
            if (attacker.Weapon.DamageType != DamageType.Chopping) return;
            var reduce = attacker.Weapon.Damage;
            context.ExtraDamage -= reduce;

            if (context.IsMissed) return;
            DamageNumbers.Instance.SpawnNumber($"Resistance!", target.transform.position, DamageNumbers.DamageType.Buffs);
        }
    }

    [Serializable]
    public class FireBreath : IAbility
    {
        public void OnTurnStart(Unit character, int turnNumber, AttackContext context)
        {
            if (turnNumber % 3 != 0) return;
            context.ExtraDamage += 3;
            DamageNumbers.Instance.SpawnNumber($"Fire breath!", character.transform.position, DamageNumbers.DamageType.Buffs);
            Debug.Log($"Fire Breath triggered! Extra damage 3 applied.");
        }
    }
}